// Production-ready implementation in previous messages